<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>FootprintAI - Your Elite Eco-Intelligence</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
<style>
  /* Base Reset & Variables */
  :root {
    --color-primary: #1bd741; /* Clean Green */
    --color-primary-light: #76f377;
    --color-primary-dark: #0b7b12;
    --color-bg-dark: #0A0A0A; /* Deeper, richer black */
    --color-surface-dark: #1C1C1C; /* Soft dark grey for main app background */
    --color-card-bg: #282828; /* Slightly lighter card background */
    --color-text-light: #E0E0E0; /* Soft white for main text */
    --color-text-medium: #A0A0A0; /* Subtler text */
    --color-text-accent: #1bd741; /* Use primary for accents in text */
    --shadow-subtle: 0 4px 12px rgba(0,0,0,0.4); /* Stronger shadow */
    --shadow-green-glow: 0 0 15px rgba(27,215,65,0.6); /* More pronounced glow */
    --border-subtle: 1px solid #333;
    --border-accent: 1px solid var(--color-primary-dark);
  }

  * {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
  }
  body {
    margin: 0; padding: 0;
    font-family: 'Inter', sans-serif;
    background: var(--color-bg-dark);
    color: var(--color-text-light);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    overflow-x: hidden;
  }

  /* Global Animations - Next Level */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  @keyframes subtleGlow {
    0% { box-shadow: 0 0 10px rgba(27,215,65,0.4); }
    50% { box-shadow: 0 0 20px rgba(27,215,65,0.7); }
    100% { box-shadow: 0 0 10px rgba(27,215,65,0.4); }
  }
  @keyframes pulseOpacity {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
  }
  @keyframes slideInUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  @keyframes popIn {
    from { transform: scale(0.8) translateY(10px); opacity: 0; }
    to { transform: scale(1) translateY(0); opacity: 1; }
  }
  @keyframes shakeX {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
    20%, 40%, 60%, 80% { transform: translateX(5px); }
  }
  @keyframes pointsEarned {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    25% { transform: translateY(-15px) scale(1.1); opacity: 0.8; }
    50% { transform: translateY(-30px) scale(1.2); opacity: 0; }
    100% { transform: translateY(-30px) scale(1.2); opacity: 0; }
  }
  @keyframes popupScaleIn {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }


  /* Loading Overlay - More engaging and organic */
  #loading-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: radial-gradient(circle at center, #1C1C1C 0%, #0A0A0A 100%); /* Radial gradient for depth */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    opacity: 1;
    visibility: visible;
    transition: opacity 0.8s ease-out, visibility 0.8s ease-out;
  }
  #loading-overlay.hidden {
    opacity: 0;
    visibility: hidden;
  }

  .loading-logo {
    position: relative;
    width: 140px; /* Larger to accommodate animation */
    height: 140px;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 30px;
  }
  .loading-logo .circle {
    position: absolute;
    width: 140px;
    height: 140px;
    border-radius: 50%;
    background: radial-gradient(circle, var(--color-primary-light) 0%, var(--color-primary) 50%, var(--color-primary-dark) 100%);
    opacity: 0;
    transform: scale(0);
    animation: circleGrow 2s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards; /* Bouncier grow */
    box-shadow: 0 0 30px rgba(27,215,65,0.8); /* Stronger glow */
  }
  .loading-logo .leaf-icon {
    position: absolute;
    font-family: 'Material Icons';
    font-size: 110px; /* Larger icon */
    color: rgba(255,255,255,0.9);
    opacity: 0;
    transform: scale(0.3) rotate(0deg); /* Start smaller, no rotation */
    animation: leafReveal 1.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) 1.2s forwards; /* Bouncier, delayed reveal */
    text-shadow: 0 0 20px rgba(255,255,255,0.7);
  }
  @keyframes circleGrow {
    0% { opacity: 0; transform: scale(0); }
    70% { opacity: 1; transform: scale(1.05); }
    100% { opacity: 1; transform: scale(1); }
  }
  @keyframes leafReveal {
    0% { opacity: 0; transform: scale(0.3) rotate(0deg); }
    50% { opacity: 1; transform: scale(1.2) rotate(15deg); } /* Overshoot and rotate */
    100% { opacity: 1; transform: scale(1) rotate(0deg); }
  }
  @keyframes textGrowIn {
    0% { opacity: 0; transform: scale(0.8); letter-spacing: 0.5em; }
    100% { opacity: 1; transform: scale(1); letter-spacing: 0em; }
  }

  .loading-text {
    font-family: 'Inter', sans-serif;
    font-weight: 800;
    font-size: 2.8rem; /* Even larger text */
    color: var(--color-text-light);
    opacity: 0;
    animation: textGrowIn 1s ease-out 2.5s forwards; /* New text animation after leaf */
    text-shadow: 0 0 15px rgba(255,255,255,0.5);
  }

  /* App Container */
  #app {
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    max-width: 420px;
    margin: 0 auto;
    background: var(--color-surface-dark);
    box-shadow: var(--shadow-subtle);
    position: relative;
    overflow: hidden;
    transform: translateY(20px);
    opacity: 0;
    transition: opacity 0.6s ease-out 0.2s, transform 0.6s ease-out 0.2s;
    border-radius: 20px;
  }
  #app.loaded {
    opacity: 1;
    transform: translateY(0);
  }

  /* Header */
  header {
    background: linear-gradient(135deg, #1A1A1A 0%, #0F0F0F 100%);
    color: var(--color-text-light);
    padding: 1.2rem 1.5rem;
    font-weight: 700;
    font-size: 1.5rem;
    text-align: center;
    user-select: none;
    border-bottom: 1px solid #303030;
    position: sticky;
    top: 0;
    z-index: 20;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
  }

  main {
    flex: 1 1 auto;
    overflow: hidden;
    padding: 1.5rem;
    position: relative; /* Crucial for positioning elements within main */
    min-height: calc(100vh - 60px - 70px);
  }

  /* Points Display on Home - Repositioned */
  .points-display { /* Removed #home scope to apply globally within main */
    position: absolute;
    top: 1.2rem; /* Adjusted position */
    right: 1.2rem; /* Adjusted position */
    background: rgba(27,215,65,0.15);
    border-radius: 20px;
    padding: 0.5rem 1rem;
    font-weight: 600;
    color: var(--color-primary-light);
    display: flex;
    align-items: center;
    user-select: none;
    backdrop-filter: blur(8px);
    border: 1px solid rgba(27,215,65,0.25);
    box-shadow: var(--shadow-green-glow);
    animation: subtleGlow 4s infinite alternate;
    z-index: 10; /* Ensure it's above other content in main */
  }
  .points-display .material-icons {
    margin-right: 0.5rem;
    font-size: 20px;
    color: var(--color-primary);
  }
  /* Animation for points earning */
  #pointsEarnedAnimation { /* Specific ID for precise positioning */
    position: absolute;
    color: var(--color-primary-light);
    font-weight: 800;
    font-size: 1.5rem;
    animation: pointsEarned 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; /* Bouncier points animation */
    pointer-events: none;
    text-shadow: 0 0 10px rgba(27,215,65,0.8);
    z-index: 11; /* Above points display */
  }

  /* Bottom Navigation - Smoother interaction */
  nav.bottom-nav {
    position: sticky;
    bottom: 0; left: 0;
    width: 100%;
    max-width: 420px;
    height: 70px;
    background: linear-gradient(to top, #0A0A0AEE, #0A0A0AAA);
    border-top: 1px solid #303030;
    display: flex;
    justify-content: space-around;
    align-items: center;
    z-index: 30;
    backdrop-filter: blur(10px) saturate(180%);
    box-shadow: 0 -4px 15px rgba(0,0,0,0.5);
  }
  nav.bottom-nav button {
    background: none;
    border: none;
    flex-direction: column;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 8px 12px;
    cursor: pointer;
    color: #888;
    font-size: 0.8rem;
    font-weight: 600;
    user-select: none;
    transition: color 0.3s ease, transform 0.2s ease, background-color 0.2s ease;
    border-radius: 8px;
  }
  nav.bottom-nav button .material-icons {
    font-size: 24px;
    margin-bottom: 2px;
    transition: color 0.3s ease, transform 0.2s ease;
  }
  nav.bottom-nav button.active,
  nav.bottom-nav button:hover {
    color: var(--color-primary);
    transform: translateY(-3px);
    background-color: rgba(27,215,65,0.1);
  }
  nav.bottom-nav button.active .material-icons {
    color: var(--color-primary-light);
    transform: scale(1.1);
  }

  /* Section views - Advanced transitions */
  section.view {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    padding: 1.5rem;
    overflow-y: auto;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), visibility 0s linear 0.5s;
    transform: translateX(100%); /* Start off-screen right */
  }
  section.view.active {
    opacity: 1;
    visibility: visible;
    transform: translateX(0);
    transition: opacity 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }
  section.view.sliding-out {
      opacity: 0;
      transform: translateX(-100%); /* Slide out to the left */
      transition: opacity 0.5s cubic-bezier(0.55, 0.085, 0.68, 0.53), transform 0.5s cubic-bezier(0.55, 0.085, 0.68, 0.53);
  }


  /* Common cards - More refined */
  .card {
    background: var(--color-card-bg);
    border-radius: 15px;
    box-shadow: var(--shadow-subtle);
    padding: 1.2rem 1.5rem;
    margin-bottom: 1.2rem;
    color: var(--color-text-light);
    border: var(--border-subtle);
    transition: transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94), box-shadow 0.2s ease-out;
    animation: slideInUp 0.6s ease-out backwards; /* Cards animate in */
  }
  .card:hover {
      transform: translateY(-5px) scale(1.01); /* More pronounced lift and slight scale */
      box-shadow: 0 8px 20px rgba(0,0,0,0.6); /* Deeper shadow on hover */
  }
  h2 {
      color: var(--color-primary-light);
      font-weight: 700;
      font-size: 1.4rem;
      margin-top: 0;
      margin-bottom: 1rem;
  }
  p {
      color: var(--color-text-medium);
      line-height: 1.6;
  }

  /* Home Screen Styles - Clean Carbon Mirror */
  #home .carbon-mirror {
    height: 160px;
    border-radius: 15px;
    background: linear-gradient(135deg, #1bd741, #0f9c0f);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.8rem;
    color: #fff;
    text-align: center;
    user-select: none;
    box-shadow: 0 6px 20px rgba(27,215,65,0.5);
    position: relative;
    overflow: hidden;
    animation: popIn 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55) backwards;
    margin-top: 50px; /* Make space for buttons at the top */
    transition: background 0.3s ease, box-shadow 0.3s ease; /* For color change */
  }
  #carbonMirrorValue {
    text-shadow: 0 0 10px rgba(0,0,0,0.5);
    transition: color 0.3s ease; /* For text color change if needed */
  }
  /* New class for negative impact */
  #home .carbon-mirror.negative-impact {
      background: linear-gradient(135deg, #d71b1b, #9c0f0f); /* Red gradient */
      box-shadow: 0 6px 20px rgba(215,27,27,0.5); /* Red shadow */
  }
  #home .carbon-mirror.negative-impact #carbonMirrorValue {
      color: #FFF; /* Ensure text is visible on red */
  }
  #carbonMirrorValue::before {
      content: '';
      position: absolute;
      top: 0; left: -100%;
      width: 50%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      animation: shimmerBg 2.5s infinite linear;
      pointer-events: none;
  }
  @keyframes shimmerBg {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(250%); }
  }

  .today-activities ul {
      list-style: none;
      padding: 0;
      margin: 0;
  }
  .today-activities li {
    padding: 0.8rem 0;
    border-bottom: 1px solid #303030;
    font-weight: 500;
    font-size: 1rem;
    color: var(--color-text-medium);
    display: flex;
    align-items: flex-start;
    animation: fadeIn 0.5s ease-out backwards;
    animation-delay: var(--li-delay);
  }
  .today-activities li:last-child { border-bottom: none; }
  .today-activities li::before {
      content: '•';
      color: var(--color-primary);
      font-size: 1.2em;
      line-height: 1;
      margin-right: 0.8rem;
      flex-shrink: 0;
  }

  .daily-tip {
    margin-top: 1.5rem;
    background: linear-gradient(90deg, rgba(27,215,65,0.1), rgba(27,215,65,0.06));
    padding: 1rem 1.2rem;
    border-radius: 10px;
    font-weight: 600;
    font-size: 1rem;
    color: var(--color-primary-light);
    border-left: 4px solid var(--color-primary);
    box-shadow: 0 4px 12px rgba(27,215,65,0.25);
    animation: slideInUp 0.6s ease-out backwards;
    animation-delay: 0.2s;
  }

  /* Leaderboard Styles */
  #leaderboard .toggle-buttons {
    display: flex;
    justify-content: center;
    margin-bottom: 1.5rem;
    background: #222;
    border-radius: 30px;
    padding: 5px;
    box-shadow: inset 0 0 8px rgba(0,0,0,0.5);
  }
  #leaderboard .toggle-buttons button {
    flex: 1;
    padding: 0.7rem 0;
    border-radius: 25px;
    border: none;
    background: transparent;
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--color-text-medium);
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }
  #leaderboard .toggle-buttons button.active {
    background: var(--color-primary);
    color: var(--color-bg-dark);
    box-shadow: 0 4px 12px rgba(27,215,65,0.4);
    transform: scale(1.02);
  }
  .leaderboard-list ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .leaderboard-list li {
    padding: 1rem 1.2rem;
    border-bottom: 1px solid #303030;
    font-weight: 600;
    font-size: 1.05rem;
    background: var(--color-card-bg);
    margin-bottom: 0.7rem;
    border-radius: 8px;
    transition: background 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
    display: flex;
    justify-content: space-between;
    align-items: center;
    animation: slideInUp 0.5s ease-out backwards;
    animation-delay: var(--li-delay);
  }
  .leaderboard-list li:last-child { margin-bottom: 0; border-bottom: none; }
  .leaderboard-list li:hover {
      background: #383838;
      transform: translateX(3px) scale(1.005);
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
  }
  .leaderboard-list li.top3 {
    background: linear-gradient(90deg, rgba(27,215,65,0.15), rgba(27,215,65,0.08));
    color: var(--color-text-light);
    border: 1px solid rgba(11,123,18,0.9);
    box-shadow: 0 0 12px rgba(27,215,65,0.4);
  }
  .leaderboard-list li span {
      color: var(--color-primary-light);
      font-weight: 700;
  }

  /* Progress bar */
  .progress-bar-container {
    height: 20px;
    border-radius: 12px;
    background: #0a570a40;
    border: 1px solid var(--color-primary-dark);
    margin-top: 1.5rem;
    overflow: hidden;
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
  }
  .progress-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--color-primary-dark) 0%, var(--color-primary) 100%);
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(27,215,65,0.6);
    transition: width 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }
  .progress-text {
      text-align: center;
      margin-top: 0.6rem;
      font-weight: 600;
      font-size: 0.95em;
      color: var(--color-primary-light);
  }

  /* Reward Points - More vibrant */
  #rewards .points-summary {
    font-weight: 800;
    font-size: 2.5rem;
    color: var(--color-primary-light);
    text-align: center;
    margin-bottom: 1.5rem;
    text-shadow: 0 0 12px rgba(27,215,65,0.6);
    animation: pulseOpacity 2s infinite alternate;
  }
  #rewards .earned-through ul {
      list-style: none;
      padding: 0;
      margin: 0;
  }
  #rewards .earned-through li {
    padding: 0.6rem 0;
    border-bottom: 1px solid #303030;
    color: var(--color-text-medium);
    font-size: 0.95em;
    animation: fadeIn 0.5s ease-out backwards;
    animation-delay: var(--li-delay);
  }
  #rewards .earned-through li:last-child { border-bottom: none; }

  /* Simplified Redeem Section */
  #rewards .redeem-section .redeem-items {
      list-style: none;
      padding: 0;
      margin: 1rem 0 0;
  }
  #rewards .redeem-section .redeem-items li {
      background: rgba(27,215,65,0.1);
      border: 1px solid rgba(11,123,18,0.8);
      border-radius: 10px;
      padding: 1rem 1.2rem;
      margin-bottom: 0.8rem;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: flex-start;
      transition: transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94), box-shadow 0.2s ease-out;
      animation: popIn 0.6s ease-out backwards;
      animation-delay: var(--li-delay);
  }
  #rewards .redeem-section .redeem-items li:hover {
      transform: translateY(-3px) scale(1.005);
      box-shadow: 0 6px 15px rgba(27,215,65,0.4);
  }
  #rewards .redeem-section .redeem-items li strong {
      color: var(--color-primary-light);
      font-size: 1.1em;
      margin-bottom: 0.4rem;
  }
  #rewards .redeem-section .redeem-items li p {
      font-size: 0.95em;
      color: var(--color-text-medium);
      margin-bottom: 0.8rem;
  }
  #rewards .redeem-section .redeem-items li .redeem-button {
      background: var(--color-primary);
      color: var(--color-bg-dark);
      border: none;
      border-radius: 8px;
      padding: 0.6rem 1.2rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.1s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }
  #rewards .redeem-section .redeem-items li .redeem-button:hover {
      background: var(--color-primary-light);
      transform: translateY(-1px) scale(1.02);
  }
  #rewards .redeem-section .redeem-items li .redeem-button:disabled {
      background: #404040;
      color: #888;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
  }
  #rewards .redeem-section .redeem-items li .points-cost {
      font-size: 1em;
      color: var(--color-primary);
      font-weight: 700;
      align-self: flex-end;
      margin-top: -1.5rem;
      margin-right: 0;
  }


  .streak-tracker {
    font-weight: 600;
    font-size: 1.05rem;
    color: var(--color-primary-light);
    text-align: center;
    margin-top: 1.5rem;
    padding: 0.8rem;
    background: rgba(27,215,65,0.08);
    border-radius: 8px;
    border: 1px solid rgba(27,215,65,0.15);
    animation: slideInUp 0.6s ease-out backwards;
    animation-delay: 0.3s;
  }

  .badge-gallery .badge-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 10px;
      margin-top: 1rem;
  }
  .badge-item {
      background: #222;
      border-radius: 10px;
      padding: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      min-height: 90px;
      border: 1px solid #303030;
      position: relative;
      overflow: hidden;
      transition: transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94), box-shadow 0.2s ease-out;
      animation: popIn 0.5s ease-out backwards;
      animation-delay: var(--li-delay);
  }
  .badge-item:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 6px 15px rgba(0,0,0,0.4), 0 0 12px rgba(27,215,65,0.35);
  }

  /* Updated styles for Material Icons in badges */
  .badge-item .material-icons {
      font-size: 60px; /* Adjust size as needed */
      color: #888888; /* Default color for locked badges */
      opacity: 0.4; /* Default opacity for locked badges */
      transition: color 0.5s ease, opacity 0.5s ease, transform 0.3s ease;
      margin-bottom: 4px; /* Space between icon and text */
  }

  .badge-item.unlocked .material-icons {
      color: var(--color-primary-light); /* Green for unlocked */
      opacity: 1; /* Full opacity for unlocked */
      transform: scale(1.1) rotate(5deg);
  }
  .badge-item span {
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--color-text-medium);
      line-height: 1.3;
  }
  .badge-item.locked::before {
      content: '🔒';
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2.5em;
      color: rgba(255,255,255,0.25);
      z-index: 1;
      pointer-events: none;
  }
  .badge-item.unlocked span {
      color: var(--color-primary-light);
      font-weight: 600;
  }

  /* Calendar */
  .calendar-container {
    margin-top: 1rem;
  }
  .calendar-title {
    font-weight: 700;
    margin-bottom: 1rem;
    font-size: 1.3rem;
    text-align: center;
    color: var(--color-primary-light);
  }
  table.calendar {
    width: 100%;
    border-collapse: separate;
    border-spacing: 2px;
    border-radius: 12px;
    overflow: hidden;
    background: #1a1a1a;
    box-shadow: var(--shadow-subtle);
  }
  table.calendar th, table.calendar td {
    padding: 8px 6px;
    text-align: center;
    vertical-align: middle;
    cursor: pointer;
    background: var(--color-card-bg);
    transition: background 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
    border-radius: 6px;
    color: var(--color-text-medium);
    font-size: 0.9em;
  }
  table.calendar th {
      color: var(--color-primary);
      font-weight: 600;
      background: #202020;
  }
  table.calendar td:hover {
      background: #353535;
      transform: scale(1.03);
      box-shadow: 0 0 8px rgba(27,215,65,0.3);
  }
  table.calendar td.today {
    background: var(--color-primary) !important;
    font-weight: 700;
    color: var(--color-bg-dark);
    box-shadow: 0 0 12px rgba(27,215,65,0.8);
    transform: scale(1.05);
  }
  table.calendar td.selected {
    outline: 2px solid var(--color-primary-light);
    outline-offset: 2px;
    box-shadow: 0 0 12px rgba(27,215,65,0.8);
  }

  /* Daily Stats Popup - Sleeker */
  #dailyStatsPopup {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.8);
    justify-content: center;
    align-items: center;
    z-index: 100;
    backdrop-filter: blur(6px);
  }
  #dailyStatsContent {
    background: linear-gradient(135deg, #1f1f1f, #121212);
    border-radius: 15px;
    padding: 1.5rem;
    box-shadow: 0 10px 25px rgba(0,0,0,0.7);
    color: var(--color-text-light);
    border: 1px solid #303030;
    position: relative;
    max-width: 90%;
    width: 350px;
    animation: popupScaleIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
  #dailyStatsContent h3 {
    color: var(--color-primary);
    font-size: 1.4rem;
    margin-bottom: 1rem;
    text-align: center;
  }
  #dailyStatsContent ul {
    list-style: none;
    padding: 0;
    margin-bottom: 1.2rem;
  }
  #dailyStatsContent li {
    padding: 0.5rem 0;
    border-bottom: 1px dashed #282828;
    font-size: 0.95em;
    color: var(--color-text-medium);
  }
  #dailyStatsContent li:last-child {
      border-bottom: none;
  }
  #dailyStatsClose {
    background: var(--color-primary);
    color: var(--color-bg-dark);
    padding: 0.6rem 1.2rem;
    border-radius: 10px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: background 0.2s ease, transform 0.1s ease;
  }
  #dailyStatsClose:hover {
    background: var(--color-primary-light);
    transform: translateY(-2px);
  }

  /* Profile - Clean & Functional */
  #profile .profile-header {
    display: flex;
    flex-direction: column; /* Stack avatar and text */
    align-items: center;
    gap: 0.8rem;
    margin-bottom: 1.5rem;
    text-align: center;
  }
  #profile .avatar {
    width: 90px; /* Larger avatar */
    height: 90px;
    border-radius: 50%;
    background: linear-gradient(45deg, var(--color-primary-dark), var(--color-primary-light));
    display: flex;
    justify-content: center;
    align-items: center;
    color: #fff; /* White for better contrast on gradient */
    font-weight: 700;
    font-size: 2.5rem; /* Larger initial */
    border: 3px solid rgba(255,255,255,0.1);
    box-shadow: 0 0 15px rgba(27,215,65,0.6);
    transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
  }
  #profile .avatar:hover {
    transform: scale(1.1) rotate(3deg); /* More dynamic hover */
    box-shadow: 0 0 25px rgba(27,215,65,0.9);
  }
  #profile .profile-name {
    font-weight: 800; /* Bolder name */
    font-size: 2.2rem; /* Larger name */
    color: var(--color-text-light);
    margin: 0; /* Remove default margin */
    text-shadow: 0 0 8px rgba(255,255,255,0.3);
  }
  #profile .profile-bio {
      color: var(--color-text-medium);
      font-size: 0.95rem;
      margin-top: 0.5rem;
      max-width: 80%;
      line-height: 1.5;
  }

  #profile .profile-stats p {
    font-weight: 500;
    font-size: 1rem;
    color: var(--color-text-medium);
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  #profile .profile-stats p .material-icons {
      font-size: 1.2em;
      color: var(--color-primary);
  }
  #profile .profile-stats strong {
      color: var(--color-primary-light);
      font-weight: 700;
  }

  /* Green Snap specific styles - now for a global popup */
  /* This is the inner content box for the Green Snap popup */
  .green-snap-popup {
    background: linear-gradient(135deg, #1f1f1f, #121212);
    border-radius: 15px;
    padding: 1.5rem;
    box-shadow: 0 10px 25px rgba(0,0,0,0.7), 0 0 15px rgba(27,215,65,0.5);
    border: 1px solid #303030;
    max-width: 90%;
    width: 350px;
    animation: popupScaleIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Added animation here */
  }
  .green-snap-popup label {
    font-size: 1rem;
    color: var(--color-primary-light);
    display: block;
    margin-bottom: 0.8rem;
  }
  .green-snap-popup input[type="text"] {
    width: 100%;
    padding: 0.8rem;
    margin-bottom: 1.2rem;
    background: #333;
    border: 1px solid #555;
    border-radius: 8px;
    color: var(--color-text-light);
    font-family: 'Inter', sans-serif;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }
  .green-snap-popup input[type="text"]:focus {
    border-color: var(--color-primary);
    box-shadow: 0 0 8px rgba(27,215,65,0.5);
    outline: none;
  }
  .green-snap-popup .upload-button {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 0.6rem 1rem;
    background: var(--color-primary-dark);
    color: var(--color-text-light);
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.2s ease, transform 0.1s ease;
    margin-bottom: 1.2rem;
  }
  .green-snap-popup .upload-button:hover {
    background: var(--color-primary);
    transform: translateY(-1px);
  }
  .green-snap-popup .upload-button .material-icons {
    font-size: 20px;
  }
  #greenSnapProofPreview {
    width: 100%;
    height: 180px;
    background: #1a1a1a;
    border: 1px dashed #383838;
    border-radius: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    margin-top: 1rem;
    margin-bottom: 1.2rem;
  }
  #greenSnapProofPreview img {
    max-width: 100%;
    max-height: 100%;
    object-fit: cover;
    border-radius: 8px;
  }
  .green-snap-popup small {
      display: block;
      margin-top: 0.5rem;
      color: var(--color-text-medium);
      font-size: 0.85em;
  }
  .green-snap-popup button {
      transition: background 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
  }
  .green-snap-popup button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  .green-snap-popup button:active:not(:disabled) {
      transform: translateY(0);
  }

  /* Existing settings styles (no change for now) */
  .settings label {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    margin-bottom: 0.8rem;
    color: var(--color-text-light);
    font-weight: 500;
    font-size: 1rem;
    cursor: pointer;
  }
  .settings input[type="checkbox"] {
    appearance: none;
    -webkit-appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 4px;
    background-color: #333;
    border: 1px solid #505050;
    position: relative;
    transition: background-color 0.2s ease, border-color 0.2s ease, transform 0.1s ease;
    flex-shrink: 0;
  }
  .settings input[type="checkbox"]:checked {
    background-color: var(--color-primary);
    border-color: var(--color-primary-light);
    transform: scale(1.05);
  }
  .settings input[type="checkbox"]:checked::after {
    content: '✔';
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font-size: 14px;
    color: var(--color-bg-dark);
  }


  /* Global Popup for Rewards & Info (reused for Green Snap) */
  /* This is the generic overlay for popups */
  .popup-overlay { /* Used by #dailyStatsPopup and #greenSnapPopup */
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.8);
    justify-content: center;
    align-items: center;
    z-index: 100;
    backdrop-filter: blur(6px);
  }

  /* Content box for the generic Rewards Info popup */
  #popupContent {
    background: linear-gradient(135deg, #1f1f1f, #121212);
    border-radius: 15px;
    padding: 1.5rem;
    box-shadow: 0 10px 25px rgba(0,0,0,0.7), 0 0 15px rgba(27,215,65,0.5);
    border: 1px solid #303030;
    position: relative;
    max-width: 90%;
    width: 350px;
    animation: popupScaleIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
  #popupContent h2 {
    font-size: 1.5rem;
    color: var(--color-primary);
    margin-bottom: 1rem;
    text-align: center;
  }
  #popupContent ul {
    list-style: none;
    padding: 0;
    margin-bottom: 1.2rem;
  }
  #popupContent ul li {
      margin-bottom: 0.8rem;
      padding-bottom: 0.6rem;
      border-bottom: 1px solid #303030;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
  }
  #popupContent ul li:last-child {
      border-bottom: none;
  }
  #popupContent ul li strong {
      font-size: 1.05em;
      color: var(--color-primary-light);
      margin-bottom: 0.2rem;
  }
  #popupContent ul li p {
      font-size: 0.85em;
      color: var(--color-text-medium);
      margin: 0;
  }
  #popupContent ul li button {
      background: var(--color-primary-dark);
      color: var(--color-text-light);
      border: none;
      border-radius: 8px;
      padding: 0.4rem 0.8rem;
      font-weight: 500;
      cursor: pointer;
      margin-top: 0.6rem;
      transition: background 0.2s ease, transform 0.1s ease;
  }
  #popupContent ul li button:hover {
      background: var(--color-primary);
      transform: translateY(-1px);
  }
  #popupContent ul li button:disabled {
      background: #404040;
      color: #888;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
  }
  #popupCloseBtn {
    display: block;
    width: 100%;
    background: var(--color-primary);
    color: var(--color-bg-dark);
    border-radius: 10px;
    padding: 0.8rem 1.5rem;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: background 0.2s ease, transform 0.1s ease;
  }
  #popupCloseBtn:hover {
    background: var(--color-primary-light);
    transform: translateY(-2px);
  }

  /* Specific styles for the "More" button on Home - Repositioned */
  #moreActionsBtn { /* Removed #home scope */
      position: absolute;
      top: 1.2rem; /* Adjusted position */
      left: 1.2rem; /* Adjusted position */
      background: rgba(27,215,65,0.15);
      border: 1px solid rgba(27,215,65,0.25);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
      color: var(--color-primary-light);
      box-shadow: var(--shadow-green-glow);
      animation: subtleGlow 4s infinite alternate, pulseOpacity 2s infinite alternate;
      z-index: 10; /* Ensure it's above other content in main */
  }
  #moreActionsBtn:hover {
      background: rgba(27,215,65,0.25);
      transform: scale(1.1);
  }
  #moreActionsBtn .material-icons {
      font-size: 24px;
  }

</style>
</head>
<body>

<!-- Loading Overlay -->
<div id="loading-overlay">
  <div class="loading-logo">
    <div class="circle"></div>
    <span class="material-icons leaf-icon">eco</span>
  </div>
  <div class="loading-text">FootprintAI</div>
</div>

<div id="app" role="main" aria-label="Footprint AI Mobile Application">

<header id="header">FootprintAI</header>

<main id="main-content" tabindex="0">

  <!-- HOME -->
  <section id="home" class="view active" aria-live="polite" aria-label="Home Dashboard">

    <!-- More actions button -->
    <button id="moreActionsBtn" class="more-actions-btn" aria-label="More eco actions">
        <span class="material-icons">more_horiz</span>
    </button>

    <!-- Points display - now with leaf icon -->
    <div class="points-display" aria-label="Current total points earned as leaves">
        <span class="material-icons">eco</span>
        <span id="totalPoints">1250</span>
    </div>

    <div id="pointsEarnedAnimation" style="display: none;">+<span id="animatedPoints">0</span></div>

    <div class="carbon-mirror" id="carbonMirror">
        <span id="carbonMirrorValue">Calculating...</span>
    </div>

    <div class="card today-activities">
        <h2>Today's Eco-Journey</h2>
        <ul id="todayActivitiesList">
            <!-- Activities will be loaded here by JS -->
            <li style="--li-delay: 0s;">You haven't used the AC for more than 1.5 hours.</li>
            <li style="--li-delay: 0.1s;">Your light consumption for today is protecting the environment.</li>
            <li style="--li-delay: 0.2s;">You have used the car for 2 hours, which is producing hazardous fumes.</li>
        </ul>
    </div>

    <div class="card daily-tip">
        <strong>Daily Eco Tip:</strong> Turn off lights when leaving a room to save energy!
    </div>
  </section>

  <!-- LEADERBOARD -->
  <section id="leaderboard" class="view" aria-live="polite" aria-label="Leaderboard">
    <h2>Leaderboard</h2>
    <div class="toggle-buttons">
        <button id="toggleLocal" class="active">Local</button>
        <button id="toggleGlobal">Global</button>
    </div>
    <div class="leaderboard-list">
        <ul id="leaderboardList">
            <!-- Leaderboard items will be loaded here by JS -->
        </ul>
    </div>
  </section>

  <!-- REWARDS -->
  <section id="rewards" class="view" aria-live="polite" aria-label="Rewards and Achievements">
    <h2>Your Rewards</h2>
    <div class="card">
        <h3>Total Points:</h3>
        <p class="points-summary"><span id="currentRewardPoints">1250</span> Pts</p>
    </div>

    <div class="card earned-through">
        <h3>Earned Through:</h3>
        <ul>
            <li style="--li-delay: 0s;">Daily Eco Challenges: <span>+50 Pts</span></li>
            <li style="--li-delay: 0.1s;">Maintaining consecutive green streaks: <span>+100 Pts</span></li>
            <li style="--li-delay: 0.2s;">Participating in community events: <span>+200 Pts</span></li>
        </ul>
    </div>

    <div class="card redeem-section">
        <h2>Redeem Your Points</h2>
        <ul class="redeem-items">
            <li style="--li-delay: 0s;">
                <strong>1-Week Premium Membership</strong>
                <p>Unlock advanced features and personalized eco-insights for a week.</p>
                <span class="points-cost">500 Pts</span>
                <button class="redeem-button" data-cost="500">Redeem Now</button>
            </li>
            <li style="--li-delay: 0.1s;">
                <strong>Exclusive Eco-Friendly E-book</strong>
                <p>Learn advanced tips for sustainable living.</p>
                <span class="points-cost">300 Pts</span>
                <button class="redeem-button" data-cost="300">Redeem Now</button>
            </li>
            <li style="--li-delay: 0.2s;">
                <strong>Tree Planting Donation</strong>
                <p>Donate points to plant a real tree through our partners.</p>
                <span class="points-cost">100 Pts</span>
                <button class="redeem-button" data-cost="100">Redeem Now</button>
            </li>
        </ul>
    </div>

    <div class="card streak-tracker">
        Your current eco-streak: <strong id="ecoStreak">7 days</strong>
    </div>

    <div class="card badge-gallery">
        <h2>Eco Badges</h2>
        <div class="badge-grid" id="badgeGrid">
            <!-- Updated badges to use Material Icons -->
            <div class="badge-item unlocked" style="--li-delay: 0s;">
                <span class="material-icons">eco</span>
                <span>First Step</span>
            </div>
            <div class="badge-item unlocked" style="--li-delay: 0.1s;">
                <span class="material-icons">water_drop</span>
                <span>Water Saver</span>
            </div>
            <div class="badge-item locked" style="--li-delay: 0.2s;">
                <span class="material-icons">lightbulb</span>
                <span>Energy Hero</span>
            </div>
            <div class="badge-item locked" style="--li-delay: 0.3s;">
                <span class="material-icons">directions_bike</span>
                <span>Cycle Commuter</span>
            </div>
             <div class="badge-item locked" style="--li-delay: 0.4s;">
                <span class="material-icons">recycling</span>
                <span>Recycler</span>
            </div>
             <div class="badge-item locked" style="--li-delay: 0.5s;">
                <span class="material-icons">park</span>
                <span>Tree Planter</span>
            </div>
        </div>
    </div>
  </section>

  <!-- CALENDAR -->
  <section id="calendar" class="view" aria-live="polite" aria-label="Daily Eco Calendar">
    <h2>Eco Calendar</h2>
    <div class="card calendar-container">
        <h3 class="calendar-title" id="currentMonthYear">June 2025</h3>
        <table class="calendar">
            <thead>
                <tr>
                    <th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th>
                </tr>
            </thead>
            <tbody id="calendarBody">
                <!-- Calendar days will be generated by JS -->
            </tbody>
        </table>
        <div class="progress-bar-container">
            <div class="progress-bar-fill" style="width: 75%;"></div>
        </div>
        <p class="progress-text">Daily Goal: 75% Achieved</p>
    </div>

    <div class="card">
        <h3>Streak History</h3>
        <p>You've maintained a green streak for the past 7 days! Keep it up!</p>
    </div>
  </section>

  <!-- PROFILE -->
  <section id="profile" class="view" aria-live="polite" aria-label="User Profile">
    <h2>Profile</h2>
    <div class="card">
        <div class="profile-header">
            <div class="avatar">SJ</div> <!-- Initials for Sahibjot -->
            <h3 class="profile-name">Sahibjot Singh</h3>
            <p class="profile-bio">Passionate about leveraging technology for a sustainable future. Committed to reducing my digital and physical carbon footprint, one green action at a time!</p>
        </div>
        <div class="profile-stats">
            <p><span class="material-icons">eco</span> Total Eco Points: <strong>1250</strong></p>
            <p><span class="material-icons">trending_up</span> Eco Streak: <strong>7 days</strong></p>
            <p><span class="material-icons">workspace_premium</span> Badges Unlocked: <strong>2</strong></p>
            <p><span class="material-icons">calendar_month</span> Member Since: <strong>Jan 2025</strong></p>
            <p><span class="material-icons">location_on</span> Location: <strong>Ludhiana, India</strong></p>
        </div>
    </div>

    <div class="card">
        <h2>My Eco Goals</h2>
        <ul>
            <li>Reduce electricity consumption by 15% monthly.</li>
            <li>Use public transport or cycle 3 times a week.</li>
            <li>Participate in 1 community clean-up event per quarter.</li>
        </ul>
    </div>

    <div class="card">
        <h2>Account Settings</h2>
        <a href="#" id="openSettingsBtn" style="color: var(--color-primary-light); text-decoration: none; font-weight: 600;">Manage Settings</a>
    </div>
  </section>

  <!-- SETTINGS (Accessible from Profile) -->
  <section id="settings" class="view" aria-live="polite" aria-label="Application Settings">
    <h2>Settings</h2>
    <div class="card settings">
        <h3>General</h3>
        <label>
            <input type="checkbox" checked> Enable Notifications
        </label>
        <label>
            <input type="checkbox"> Dark Mode (Always On)
        </label>
    </div>

    <div class="card settings">
        <h3>Privacy</h3>
        <label>
            <input type="checkbox"> Share Anonymized Data
        </label>
    </div>

    <div class="card">
        <h3>App Version</h3>
        <p>FootprintAI v1.0.0</p>
    </div>
  </section>

</main>

<nav class="bottom-nav" aria-label="Main navigation">
  <button data-view="home" class="active" aria-label="Home">
    <span class="material-icons">home</span>
    <span>Home</span>
  </button>
  <button data-view="leaderboard" aria-label="Leaderboard">
    <span class="material-icons">leaderboard</span>
    <span>Leaderboard</span>
  </button>
  <button data-view="rewards" aria-label="Rewards">
    <span class="material-icons">emoji_events</span>
    <span>Rewards</span>
  </button>
  <button data-view="calendar" aria-label="Calendar">
    <span class="material-icons">calendar_today</span>
    <span>Calendar</span>
  </button>
  <button data-view="profile" aria-label="Profile">
    <span class="material-icons">person</span>
    <span>Profile</span>
  </button>
</nav>

</div>

<!-- Global Popups -->

<!-- Daily Stats Popup (for Calendar) -->
<div id="dailyStatsPopup" class="popup-overlay">
  <div id="dailyStatsContent">
    <h3>Daily Stats for <span id="dailyStatsDate"></span></h3>
    <ul id="dailyStatsList">
      <!-- Stats will be loaded here by JS -->
    </ul>
    <button id="dailyStatsClose">Close</button>
  </div>
</div>

<!-- Green Snap Popup (for More Actions button) -->
<div id="greenSnapPopup" class="popup-overlay">
    <div class="green-snap-popup">
        <h2>Green Snap</h2>
        <p>Capture your eco-friendly actions and earn points!</p>
        <label for="ecoActionName">Eco Action Name:</label>
        <input type="text" id="ecoActionName" placeholder="e.g., Rode bike to work">

        <input type="file" id="greenSnapProofUpload" accept="image/*" style="display: none;">
        <button class="upload-button" onclick="document.getElementById('greenSnapProofUpload').click()">
            <span class="material-icons">cloud_upload</span> Upload Proof
        </button>
        <div id="greenSnapProofPreview">
            <span>No image selected</span>
        </div>
        <small>Upload a photo of your eco-action.</small>

        <div style="display: flex; justify-content: space-between; margin-top: 1.5rem;">
            <button id="greenSnapCancel" class="redeem-button" style="background: #555;">Cancel</button>
            <button id="greenSnapSubmit" class="redeem-button">Submit</button>
        </div>
    </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', () => {
    const loadingOverlay = document.getElementById('loading-overlay');
    const app = document.getElementById('app');
    const bottomNavButtons = document.querySelectorAll('.bottom-nav button');
    const views = document.querySelectorAll('.view');
    const totalPointsSpan = document.getElementById('totalPoints');
    const animatedPointsSpan = document.getElementById('animatedPoints');
    const pointsEarnedAnimation = document.getElementById('pointsEarnedAnimation');
    const carbonMirrorValue = document.getElementById('carbonMirrorValue');
    const carbonMirrorDiv = document.getElementById('carbonMirror'); // Get the div itself
    const openSettingsBtn = document.getElementById('openSettingsBtn');

    // Calendar elements
    const calendarBody = document.getElementById('calendarBody');
    const currentMonthYear = document.getElementById('currentMonthYear');
    const dailyStatsPopup = document.getElementById('dailyStatsPopup');
    const dailyStatsContent = document.getElementById('dailyStatsContent');
    const dailyStatsDateSpan = document.getElementById('dailyStatsDate');
    const dailyStatsList = document.getElementById('dailyStatsList');
    const dailyStatsCloseBtn = document.getElementById('dailyStatsClose');

    // Green Snap elements
    const moreActionsBtn = document.getElementById('moreActionsBtn');
    const greenSnapPopup = document.getElementById('greenSnapPopup'); // This is the outer overlay div
    const greenSnapCancelBtn = greenSnapPopup.querySelector('#greenSnapCancel');
    const greenSnapSubmitBtn = greenSnapPopup.querySelector('#greenSnapSubmit');
    const greenSnapProofUpload = greenSnapPopup.querySelector('#greenSnapProofUpload');
    const greenSnapProofPreview = greenSnapPopup.querySelector('#greenSnapProofPreview');
    const ecoActionNameInput = greenSnapPopup.querySelector('#ecoActionName');

    let currentActiveView = 'home';
    let currentPoints = 1250; // Initial points
    let selectedCalendarDate = null; // To store the selected date for daily stats

    // Define negative keywords for the simplified sentiment analysis
    const negativeKeywords = [
        "used ac", "ac very much", "car", "travelled by car", "long shower",
        "wasted", "excessive", "more", "unplugged", "forgot to turn off",
        "didn't recycle", "non-eco", "plastic", "burn", "pollute", "fumes"
    ];


    // Set initial display of popups to none and visibility to hidden
    dailyStatsPopup.style.display = 'none';
    dailyStatsPopup.style.visibility = 'hidden';
    greenSnapPopup.style.display = 'none';
    greenSnapPopup.style.visibility = 'hidden';


    // Simulate loading time
    setTimeout(() => {
        loadingOverlay.classList.add('hidden');
        app.classList.add('loaded');
        updateCarbonMirror(); // Update carbon mirror value after loading
    }, 3500); // Increased timeout for the new animations

    // Navigation functionality
    bottomNavButtons.forEach(button => {
        button.addEventListener('click', () => {
            const targetViewId = button.dataset.view;

            if (targetViewId === currentActiveView) return; // Prevent re-activating the same view

            // Deactivate current view
            const currentViewElement = document.getElementById(currentActiveView);
            if (currentViewElement) {
                currentViewElement.classList.add('sliding-out');
                // Wait for the slide-out animation to finish before deactivating and sliding in new view
                setTimeout(() => {
                    currentViewElement.classList.remove('active', 'sliding-out');
                    activateView(targetViewId);
                }, 500); // Match this with the transition duration of section.view
            } else {
                activateView(targetViewId);
            }

            // Update active state for buttons
            bottomNavButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
        });
    });

    function activateView(viewId) {
        views.forEach(view => {
            if (view.id === viewId) {
                view.classList.add('active');
                view.scrollTop = 0; // Scroll to top of the new view
                currentActiveView = viewId;
            }
        });
    }

    // Settings button functionality
    openSettingsBtn.addEventListener('click', (e) => {
        e.preventDefault();
        const currentViewElement = document.getElementById(currentActiveView);
        if (currentViewElement) {
            currentViewElement.classList.add('sliding-out');
            setTimeout(() => {
                currentViewElement.classList.remove('active', 'sliding-out');
                activateView('settings');
            }, 500);
        } else {
            activateView('settings');
        }
        bottomNavButtons.forEach(btn => btn.classList.remove('active')); // No nav button active for settings
    });

    // --- Points & Carbon Mirror Logic ---
    function updateCarbonMirror(impact = null) {
        // This function now takes an optional 'impact' parameter to override random calculation
        const carbonValues = [
            "Excellent (Low Impact)",
            "Good (Moderate Impact)",
            "Moderate (Average Impact)",
            "High (Significant Impact)"
        ];
        let displayValue;
        if (impact === 'negative') {
            displayValue = "High Impact (Negative Action)";
            carbonMirrorDiv.classList.add('negative-impact');
        } else {
            displayValue = carbonValues[Math.floor(Math.random() * carbonValues.length)];
            carbonMirrorDiv.classList.remove('negative-impact');
        }
        carbonMirrorValue.textContent = displayValue;

        // Reset to default "Calculating..." after a short display if it was a direct impact
        if (impact) {
            setTimeout(() => {
                carbonMirrorValue.textContent = "Calculating...";
                carbonMirrorDiv.classList.remove('negative-impact');
                setTimeout(updateCarbonMirror, 1000); // Recalculate after another second
            }, 3000); // Display impact for 3 seconds
        }
    }

    // Function to add points with animation (can now handle negative values)
    function addPoints(amount) {
        const initialPoints = currentPoints;
        currentPoints += amount;
        totalPointsSpan.textContent = currentPoints;
        document.getElementById('currentRewardPoints').textContent = currentPoints; // Update rewards total too

        pointsEarnedAnimation.style.display = 'block';
        animatedPointsSpan.textContent = (amount > 0 ? '+' : '') + amount; // Show + or -
        pointsEarnedAnimation.style.left = `${totalPointsSpan.offsetLeft + (totalPointsSpan.offsetWidth / 2)}px`;
        pointsEarnedAnimation.style.top = `${totalPointsSpan.offsetTop + (totalPointsSpan.offsetHeight / 2)}px`;
        pointsEarnedAnimation.style.color = amount > 0 ? 'var(--color-primary-light)' : '#FF4C4C'; // Red for negative

        // Trigger reflow to restart animation
        pointsEarnedAnimation.style.animation = 'none';
        void pointsEarnedAnimation.offsetWidth; // Trigger reflow
        pointsEarnedAnimation.style.animation = null;
        pointsEarnedAnimation.style.animation = 'pointsEarned 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards';

        // Hide animation after it finishes
        setTimeout(() => {
            pointsEarnedAnimation.style.display = 'none';
        }, 1200); // Match animation duration
    }

    // Simulate earning points (e.g., after a challenge submission)
    // You can call addPoints(X) from other parts of your app
    // Example: setInterval(() => addPoints(Math.floor(Math.random() * 50) + 10), 5000);

    // --- Leaderboard Toggle ---
    const toggleLocalBtn = document.getElementById('toggleLocal');
    const toggleGlobalBtn = document.getElementById('toggleGlobal');
    const leaderboardList = document.getElementById('leaderboardList');

    toggleLocalBtn.addEventListener('click', () => {
        toggleLocal.classList.add('active');
        toggleGlobal.classList.remove('active');
        renderLeaderboard('local');
    });

    toggleGlobalBtn.addEventListener('click', () => {
        toggleGlobal.classList.add('active');
        toggleLocal.classList.remove('active');
        renderLeaderboard('global');
    });

    function renderLeaderboard(type) {
        let data = [];
        if (type === 'local') {
            data = [
                { name: 'Sahibjot Singh', points: 1250, isUser: true },
                { name: 'Pratik Sharma', points: 1180 },
                { name: 'Angad Singh', points: 1120 },
                { name: 'Jessica L.', points: 980 },
                { name: 'David R.', points: 910 },
                { name: 'Sarah K.', points: 870 },
            ];
        } else { // global
            data = [
                { name: 'EcoWarrior99', points: 5430 },
                { name: 'GreenLeader', points: 5100 },
                { name: 'PlanetProtector', points: 4890 },
                { name: 'Sahibjot Singh', points: 1250, isUser: true }, // Your position might be lower globally
                { name: 'SustainableSoul', points: 4120 },
                { name: 'NatureLover', points: 3800 },
            ];
        }

        leaderboardList.innerHTML = ''; // Clear current list
        data.forEach((entry, index) => {
            const li = document.createElement('li');
            li.style.setProperty('--li-delay', `${index * 0.1}s`);
            if (index < 3) {
                li.classList.add('top3');
            }
            // For the user's own entry, you might want to highlight it or show "You"
            let nameDisplay = entry.name;
            if (entry.isUser) {
                nameDisplay = `${entry.name} (You)`; // Or just 'You' if you prefer
                // Add a class for specific user styling if needed
                li.classList.add('current-user');
            }

            li.innerHTML = `${index + 1}. ${nameDisplay} <span>${entry.points}</span>`;
            leaderboardList.appendChild(li);
        });
    }
    renderLeaderboard('local'); // Initial render

    // --- Rewards Redemption ---
    const redeemButtons = document.querySelectorAll('.redeem-button');
    redeemButtons.forEach(button => {
        button.addEventListener('click', () => {
            const cost = parseInt(button.dataset.cost);
            if (currentPoints >= cost) {
                currentPoints -= cost;
                totalPointsSpan.textContent = currentPoints;
                document.getElementById('currentRewardPoints').textContent = currentPoints;
                button.textContent = 'Redeemed!';
                button.disabled = true;
                alert(`You have successfully redeemed for ${cost} points!`);
            } else {
                alert('Not enough points to redeem this item!');
            }
        });
    });

    // --- Calendar Logic ---
    function generateCalendar(year, month) {
        calendarBody.innerHTML = '';
        currentMonthYear.textContent = new Date(year, month).toLocaleString('en-US', { month: 'long', year: 'numeric' });

        const firstDayOfMonth = new Date(year, month, 1).getDay(); // 0 for Sunday, 1 for Monday...
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const today = new Date();
        const currentDay = today.getDate();
        const currentMonth = today.getMonth();
        const currentYear = today.getFullYear();

        let date = 1;
        for (let i = 0; i < 6; i++) { // Max 6 weeks in a month view
            const row = document.createElement('tr');
            for (let j = 0; j < 7; j++) { // 7 days a week
                const cell = document.createElement('td');
                if (i === 0 && j < firstDayOfMonth) {
                    // Empty cells before the first day of the month
                    cell.textContent = '';
                    cell.style.background = 'transparent';
                    cell.style.cursor = 'default';
                    cell.style.boxShadow = 'none';
                } else if (date > daysInMonth) {
                    // Empty cells after the last day of the month
                    cell.textContent = '';
                    cell.style.background = 'transparent';
                    cell.style.cursor = 'default';
                    cell.style.boxShadow = 'none';
                } else {
                    cell.textContent = date;
                    const cellDate = new Date(year, month, date);

                    // Mark today
                    if (date === currentDay && month === currentMonth && year === currentYear) {
                        cell.classList.add('today');
                    }

                    // Add click event to show daily stats
                    cell.addEventListener('click', () => {
                        selectedCalendarDate = cellDate;
                        // Remove 'selected' class from previously selected cell
                        const previouslySelected = document.querySelector('.calendar td.selected');
                        if (previouslySelected) {
                            previouslySelected.classList.remove('selected');
                        }
                        // Add 'selected' class to the clicked cell
                        cell.classList.add('selected');
                        showDailyStats(selectedCalendarDate);
                    });
                    date++;
                }
                row.appendChild(cell);
            }
            calendarBody.appendChild(row);
            if (date > daysInMonth) break; // Stop generating rows if all days are placed
        }

         // Ensure today is marked and selected initially if not already
         const todayCell = document.querySelector('.calendar td.today');
         if (todayCell && !todayCell.classList.contains('selected')) {
             todayCell.classList.add('selected');
             selectedCalendarDate = today; // Set selectedCalendarDate to today
             showDailyStats(selectedCalendarDate); // Show stats for today by default
         }
    }

    // Function to generate random eco activities and points
    function generateRandomDailyStats() {
        const activities = [
            "Rode bike to work",
            "Used reusable water bottle",
            "Composted kitchen waste",
            "Took shorter shower",
            "Unplugged electronics",
            "Used public transport",
            "Recycled plastics and paper",
            "Ate a plant-based meal",
            "Turned off lights when leaving a room",
            "Used eco-friendly cleaning products"
        ];
        const numActivities = Math.floor(Math.random() * 4) + 1; // 1 to 4 random activities
        const stats = [];
        const chosenActivities = new Set(); // To prevent duplicate activities for a single day

        while (stats.length < numActivities) {
            const randomActivity = activities[Math.floor(Math.random() * activities.length)];
            if (!chosenActivities.has(randomActivity)) {
                const randomPoints = Math.floor(Math.random() * 40) + 10; // 10 to 50 points
                stats.push({ activity: randomActivity, points: randomPoints });
                chosenActivities.add(randomActivity);
            }
        }
        return stats;
    }

    // Function to show daily stats popup
    function showDailyStats(date) {
        dailyStatsDateSpan.textContent = date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
        dailyStatsList.innerHTML = '';

        const dataForDate = generateRandomDailyStats(); // Generate random stats

        if (dataForDate.length === 0) {
            const li = document.createElement('li');
            li.innerHTML = 'No eco activities recorded for this day.';
            dailyStatsList.appendChild(li);
        } else {
            dataForDate.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `${item.activity}: <span>+${item.points} Pts</span>`;
                dailyStatsList.appendChild(li);
            });
        }

        dailyStatsPopup.style.display = 'flex';
        dailyStatsPopup.style.visibility = 'visible'; // Ensure visibility
    }

    dailyStatsCloseBtn.addEventListener('click', () => {
        dailyStatsPopup.style.display = 'none';
        dailyStatsPopup.style.visibility = 'hidden'; // Ensure visibility
    });

    // Initialize calendar for the current month
    const today = new Date();
    generateCalendar(today.getFullYear(), today.getMonth());

    // --- Green Snap (More Actions) functionality ---
    // Function to check if the action name contains negative keywords
    function containsNegativeKeyword(text) {
        const lowerCaseText = text.toLowerCase();
        return negativeKeywords.some(keyword => lowerCaseText.includes(keyword));
    }

    moreActionsBtn.addEventListener('click', () => {
        console.log('More Actions button clicked. Attempting to open Green Snap popup.');
        greenSnapPopup.style.display = 'flex';
        greenSnapPopup.style.visibility = 'visible'; // Explicitly ensure visibility

        // Reset form when opened
        ecoActionNameInput.value = '';
        greenSnapProofPreview.innerHTML = '<span>No image selected</span>';
        greenSnapProofPreview.style.backgroundImage = 'none';
        greenSnapProofUpload.value = ''; // Clear file input
    });

    greenSnapCancelBtn.addEventListener('click', () => {
        console.log('Green Snap popup cancelled.');
        greenSnapPopup.style.display = 'none';
        greenSnapPopup.style.visibility = 'hidden'; // Explicitly ensure visibility
    });

    greenSnapSubmitBtn.addEventListener('click', () => {
        const actionName = ecoActionNameInput.value.trim();
        const imageFile = greenSnapProofUpload.files[0];

        if (!actionName) {
            alert('Please enter an action name.');
            return;
        }

        if (!imageFile) {
            alert('Please upload a proof image.');
            return;
        }

        // Determine if the action is negative based on keywords
        if (containsNegativeKeyword(actionName)) {
            const deductionAmount = Math.floor(Math.random() * 30) + 20; // Deduct 20-50 points
            alert(`Negative Eco-Action Detected: "${actionName}"! Deducting ${deductionAmount} points.`);
            addPoints(-deductionAmount); // Deduct points
            updateCarbonMirror('negative'); // Show negative impact
        } else {
            const earnedAmount = Math.floor(Math.random() * 50) + 50; // Earn 50-100 points
            alert(`Green Snap Submitted: "${actionName}"! You earned ${earnedAmount} points.`);
            addPoints(earnedAmount); // Add points
            updateCarbonMirror('positive'); // Keep positive impact (or just update randomly)
        }

        greenSnapPopup.style.display = 'none';
        greenSnapPopup.style.visibility = 'hidden'; // Explicitly ensure visibility
    });

    greenSnapProofUpload.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                greenSnapProofPreview.innerHTML = `<img src="${e.target.result}" alt="Proof Image">`;
            };
            reader.readAsDataURL(file);
        } else {
            greenSnapProofPreview.innerHTML = '<span>No image selected</span>';
        }
    });

});
</script>

</body>
</html>
